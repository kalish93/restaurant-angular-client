<div class="h-[calc(100vh-75px)] !mb-10 fixed top-[75px] w-full mx-auto overflow-y-scroll bg-gray-50 p-4">
  <div class="max-w-7xl h-full  mx-auto grid grid-cols-1 lg:grid-cols-3 gap-6">
    <div class="lg:col-span-2">
      <div class="mb-8 flex flex-wrap gap-3 items-center justify-between">
        <div class="flex flex-wrap gap-3">
          <button (click)="setCategoryFilter(null)" [class]="getFilterButtonClass(null)"
            class="rounded-full px-6 py-2.5 text-sm font-medium transition-all">
            All Items
          </button>
          <button *ngFor="let category of availableCategories" (click)="setCategoryFilter(category)"
            [class]="getFilterButtonClass(category)"
            class="rounded-full px-6 py-2.5 text-sm font-medium transition-all">
            {{ category }}
          </button>
        </div>

        <!-- Mobile Cart Button - only visible on small screens -->
        <button (click)="openCartModal()"
          class="lg:hidden relative bg-orange-500 hover:bg-orange-600 text-white rounded-full p-3 shadow-lg transition-all duration-200 flex items-center gap-2"
          [attr.aria-label]="'View cart with ' + cartCount + ' items'">
          <mat-icon class="!text-lg">shopping_cart</mat-icon>
          <span *ngIf="cartCount > 0"
            class="absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center font-semibold">
            {{ cartCount }}
          </span>
          <span class="text-sm font-medium hidden sm:inline">Cart</span>
        </button>
      </div>
      <!-- Masonry Layout -->
      <div class="masonry-container columns-1 md:columns-2">
        <mat-card *ngFor="let item of filteredMenus" class="shadow-lg rounded-xl break-inside-avoid mb-4"
          [class.expanding]="showInstructionsFor[item.id]">
          <mat-card-content class="p-3">
            <div class="flex flex-col gap-3 last:gap-0">
              <div class="flex flex-row gap-3 items-center">
                <div class="flex-shrink-0">
                  <div class="w-16 h-16 rounded-full bg-gray-100">
                    <img [src]="getImageUrl(item.image)" [alt]="item.name"
                      class="!w-full !h-full rounded-full object-fit shadow-lg" />
                  </div>
                </div>

                <div class="flex-1">
                  <div class="flex items-start justify-between mb-1">
                    <h3 class="!text-sm font-semibold text-gray-900">{{ item.name }}</h3>
                    <span class="text-sm font-bold text-orange-600 price-display ml-2">Â£{{ item.price.toFixed(2)
                      }}</span>
                  </div>
                </div>
              </div>

              <!-- Ingredients Section -->

              <p class="text-gray-600 text-xs leading-relaxed mb-2 line-clamp-2">{{ item.ingredients }}</p>

              <!-- Special Instructions Toggle -->
              <button (click)="toggleSpecialInstructions(item.id)"
                class="text-xs text-orange-600 hover:text-orange-700 font-medium transition-colors flex items-center gap-1 mb-1">
                <mat-icon class="!text-xs !h-[14px] !w-[14px]">{{ showInstructionsFor[item.id] ? 'remove' : 'add'
                  }}</mat-icon>
                {{ showInstructionsFor[item.id] ? 'Remove' : 'Add' }} Special Instructions
              </button>

              <!-- Special Instructions Textarea -->
              <div *ngIf="showInstructionsFor[item.id]"
                class="special-instructions-container  rounded-lg transition-all duration-300 ease-in-out mb-2">
                <mat-form-field appearance="outline" class="w-full !h-[100px]">
                  <mat-label>Special instructions</mat-label>
                  <textarea matInput class="!h-[100px]" cdkTextareaAutosize cdkAutosizeMinRows="4"
                    placeholder="e.g., No onions, extra spicy..." [value]="specialInstructions[item.id] || ''"
                    (input)="updateSpecialInstructions(item.id, $any($event.target).value)" class="resize-none text-xs">
                  </textarea>
                </mat-form-field>
              </div>

              <!-- Add to Cart Button -->
              <div class="flex items-center justify-center">
                <button mat-raised-button *ngIf="item.price" [ngClass]="{
                  'bg-green-600 hover:bg-green-700 text-white shadow-lg': cartItems.includes(item),
                  'bg-orange-500 hover:bg-orange-600 text-white shadow-lg': !cartItems.includes(item)
                }"
                  class="enhanced-add-button px-4 py-2 rounded-lg text-xs font-semibold transition-all duration-200 transform hover:scale-105 flex items-center gap-1 w-full"
                  (click)="addToCart(item)">
                  <mat-icon class="!text-sm">{{ cartItems.includes(item) ? 'check' : 'add_shopping_cart' }}</mat-icon>
                  <span>{{ cartItems.includes(item) ? 'Added' : 'Add to Cart' }}</span>
                </button>
              </div>
            </div>
          </mat-card-content>
        </mat-card>
      </div>
    </div>
    <div class="hidden md:block md:col-span-1">
      <app-cart></app-cart>
    </div>
    <div class="fixed bottom-6 right-6 z-50">
      <div class="relative group">
        <!-- Hover Label -->
        <div
          class="absolute bottom-full right-0 mb-2 opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none">
          <div class="bg-gray-800 text-white text-xs px-2 py-1 rounded whitespace-nowrap">
            Call Waiter
            <!-- Arrow pointing down -->
            <div
              class="absolute top-full right-2 w-0 h-0 border-l-2 border-r-2 border-t-4 border-transparent border-t-gray-800">
            </div>
          </div>
        </div>

        <!-- FAB Button -->
        <button (click)="callWaiter()"
          class="w-14 h-14 bg-orange-500 hover:bg-orange-600 text-white rounded-full shadow-lg hover:shadow-xl transition-all duration-200 flex items-center justify-center group-hover:scale-105">
          <mat-icon class="!text-xl">restaurant_menu</mat-icon>
        </button>
      </div>
    </div>
  </div>
</div>